<!DOCTYPE html>
<html lang="en">
<head>
    <script type="module" src="firebase-user-config.js"></script>
    <script type="module" src="user-firebase-functions.js"></script>
    <script type="module" src="cloudinary-uploader.js"></script>
    <script type="module" src="app.js"></script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Civic Issues - Mobile App</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="manifest" href="#" />
    <meta name="theme-color" content="#21808D" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Civic Issues">
</head>
<body>
    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Mobile Header -->
    <header class="mobile-header">
        <div class="header-content">
            <h1 class="header-title">Civic Issues</h1>
            <div class="header-actions">
                <button class="header-btn" id="notificationsBtn">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge" id="notificationCount">3</span>
                </button>
                <button class="header-btn" id="menuBtn">
                    <i class="fas fa-user-circle"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content Container -->
    <main class="main-container">
        <!-- Dashboard Page -->
        <div class="page active" id="dashboard-page">
            <div class="page-content">
                <div class="welcome-section">
                    <h2>Welcome Back!</h2>
                    <p>Stay updated on your community issues</p>
                </div>

                <!-- Dashboard Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon" style="background-color: var(--color-bg-4);">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="openIssues">2</h3>
                            <p>Open Issues</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background-color: var(--color-bg-6);">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="inProgressIssues">2</h3>
                            <p>In Progress</p>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="quick-actions-section">
                    <h3>Quick Actions</h3>
                    <div class="quick-actions-grid">
                        <button class="quick-action-btn" onclick="showPage('report')">
                            <i class="fas fa-plus-circle"></i>
                            <span>Report Issue</span>
                        </button>
                        <button class="quick-action-btn" onclick="showPage('track')">
                            <i class="fas fa-list-ul"></i>
                            <span>Track Issues</span>
                        </button>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="section-card">
                    <div class="section-header">
                        <h3>Recent Activity</h3>
                        <button class="link-btn">View All</button>
                    </div>
                    <div class="activity-list" id="activityList">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

                <!-- Announcements Carousel -->
                <div class="section-card">
                    <div class="section-header">
                        <h3>Community Updates</h3>
                    </div>
                    <div class="announcements-carousel" id="announcementsCarousel">
                        <div class="announcement-slide active">
                            <div class="announcement-content">
                                <h4>Water Main Maintenance</h4>
                                <p>Scheduled maintenance on Main St will affect water pressure tomorrow 9-11 AM</p>
                            </div>
                        </div>
                        <div class="announcement-slide">
                            <div class="announcement-content">
                                <h4>Road Closure Alert</h4>
                                <p>Park Avenue will be closed for repairs this weekend</p>
                            </div>
                        </div>
                    </div>
                    <div class="carousel-dots">
                        <span class="dot active" onclick="currentSlide(1)"></span>
                        <span class="dot" onclick="currentSlide(2)"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Report Issue Page -->
        <div class="page" id="report-page">
            <div class="page-content">
                <!-- Multi-step Progress -->
                <div class="progress-bar">
                    <div class="progress-step active" data-step="1">
                        <div class="step-circle">1</div>
                        <span>Category</span>
                    </div>
                    <div class="progress-step" data-step="2">
                        <div class="step-circle">2</div>
                        <span>Location</span>
                    </div>
                    <div class="progress-step" data-step="3">
                        <div class="step-circle">3</div>
                        <span>Details</span>
                    </div>
                    <div class="progress-step" data-step="4">
                        <div class="step-circle">4</div>
                        <span>Review</span>
                    </div>
                </div>

                <!-- Step 1: Category Selection -->
                <div class="form-step active" id="step-1">
                    <h2>What type of issue?</h2>
                    <div class="category-grid">
                        <button class="category-card" data-category="Roads" onclick="selectCategory('Roads')">
                            <i class="fas fa-road"></i>
                            <span>Roads & Potholes</span>
                        </button>
                        <button class="category-card" data-category="Utilities" onclick="selectCategory('Utilities')">
                            <i class="fas fa-lightbulb"></i>
                            <span>Street Lights</span>
                        </button>
                        <button class="category-card" data-category="Safety" onclick="selectCategory('Safety')">
                            <i class="fas fa-shield-alt"></i>
                            <span>Safety Issues</span>
                        </button>
                        <button class="category-card" data-category="Environment" onclick="selectCategory('Environment')">
                            <i class="fas fa-leaf"></i>
                            <span>Environment</span>
                        </button>
                        <button class="category-card" data-category="Parks" onclick="selectCategory('Parks')">
                            <i class="fas fa-tree"></i>
                            <span>Parks & Recreation</span>
                        </button>
                        <button class="category-card" data-category="Other" onclick="selectCategory('Other')">
                            <i class="fas fa-ellipsis-h"></i>
                            <span>Other</span>
                        </button>
                    </div>
                </div>

                <!-- Step 2: Location -->
                <div class="form-step" id="step-2">
                    <h2>Where is the issue?</h2>
                    <div class="location-section">
                        <button class="location-btn" onclick="getCurrentLocation()">
                            <i class="fas fa-location-arrow"></i>
                            <span>Use Current Location</span>
                        </button>
                        <div class="form-group">
                            <label class="form-label">Street Address</label>
                            <input type="text" class="form-control" id="issueAddress" placeholder="Enter address or nearby landmark">
                        </div>
                        <div class="location-preview" id="locationPreview">
                            <div class="map-placeholder">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>Location will be shown here</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Details -->
                <div class="form-step" id="step-3">
                    <h2>Tell us more</h2>
                    <div class="form-group">
                        <label class="form-label">Issue Title</label>
                        <input type="text" class="form-control" id="issueTitle" placeholder="Brief description of the issue">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea class="form-control" id="issueDescription" placeholder="Provide more details about the issue" rows="4"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Priority Level</label>
                        <select class="form-control" id="issuePriority">
                            <option value="Low">Low - Can wait</option>
                            <option value="Medium" selected>Medium - Needs attention</option>
                            <option value="High">High - Urgent</option>
                            <option value="Critical">Critical - Emergency</option>
                        </select>
                    </div>
                    <div class="photo-upload-section">
                        <label class="form-label">Add Photos</label>
                        <div class="photo-drop-zone" id="photoDropZone">
                            <i class="fas fa-camera"></i>
                            <p>Tap to take photo or upload</p>
                            <input type="file" id="photoInput" accept="image/*" capture="environment" multiple hidden>
                        </div>
                        <div class="photo-preview" id="photoPreview"></div>
                    </div>
                </div>

                <!-- Step 4: Review -->
                <div class="form-step" id="step-4">
                    <h2>Review & Submit</h2>
                    <div class="review-section" id="reviewSection">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

                <!-- Form Navigation -->
                <div class="form-navigation">
                    <button class="btn btn--outline btn--full-width hidden" id="prevBtn" onclick="prevStep()">
                        <i class="fas fa-arrow-left"></i> Previous
                    </button>
                    <button class="btn btn--primary btn--full-width" id="nextBtn" onclick="nextStep()">
                        Next <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Track Issues Page -->
        <div class="page" id="track-page">
            <div class="page-content">
                <div class="page-header">
                    <h2>My Issues</h2>
                    <button class="filter-btn" onclick="toggleFilters()">
                        <i class="fas fa-filter"></i>
                    </button>
                </div>

                <!-- Filters (hidden by default) -->
                <div class="filters-section hidden" id="filtersSection">
                    <div class="form-group">
                        <select class="form-control" id="statusFilterMobile">
                            <option value="">All Statuses</option>
                            <option value="Open">Open</option>
                            <option value="In Progress">In Progress</option>
                            <option value="Under Review">Under Review</option>
                            <option value="Closed">Closed</option>
                        </select>
                    </div>
                </div>

                <!-- Issues List -->
                <div class="issues-list" id="issuesList">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Notifications Page -->
        <div class="page" id="notifications-page">
            <div class="page-content">
                <div class="page-header">
                    <h2>Notifications</h2>
                    <button class="link-btn" onclick="markAllAsRead()">Mark All Read</button>
                </div>

                <div class="notifications-list" id="notificationsList">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Profile Page -->
        <div class="page" id="profile-page">
            <div class="page-content">
                <div class="profile-header">
                    <div class="profile-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <h2>John Citizen</h2>
                    <p>john@email.com</p>
                </div>

                <div class="profile-sections">
                    <div class="profile-section">
                        <button class="profile-option" onclick="showSettings()">
                            <i class="fas fa-cog"></i>
                            <span>Settings</span>
                            <i class="fas fa-chevron-right"></i>
                        </button>
                        <button class="profile-option" onclick="showHelp()">
                            <i class="fas fa-question-circle"></i>
                            <span>Help & Support</span>
                            <i class="fas fa-chevron-right"></i>
                        </button>
                        <button class="profile-option" onclick="showAbout()">
                            <i class="fas fa-info-circle"></i>
                            <span>About</span>
                            <i class="fas fa-chevron-right"></i>
                        </button>
                        <button class="profile-option danger" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Sign Out</span>
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <button class="nav-item active" data-page="dashboard" onclick="showPage('dashboard')">
            <i class="fas fa-home"></i>
            <span>Dashboard</span>
        </button>
        <button class="nav-item" data-page="report" onclick="showPage('report')">
            <i class="fas fa-plus-circle"></i>
            <span>Report</span>
        </button>
        <button class="nav-item" data-page="track" onclick="showPage('track')">
            <i class="fas fa-list-ul"></i>
            <span>Track</span>
        </button>
        <button class="nav-item" data-page="notifications" onclick="showPage('notifications')">
            <i class="fas fa-bell"></i>
            <span>Notifications</span>
        </button>
        <button class="nav-item" data-page="profile" onclick="showPage('profile')">
            <i class="fas fa-user"></i>
            <span>Profile</span>
        </button>
    </nav>

    <!-- Modal Overlay -->
    <div class="modal-overlay hidden" id="modalOverlay">
        <!-- Issue Detail Modal -->
        <div class="modal hidden" id="issueDetailModal">
            <div class="modal-header">
                <h3>Issue Details</h3>
                <button class="modal-close" onclick="closeModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="issueDetailContent">
                <!-- Populated by JavaScript -->
            </div>
            <div class="modal-footer">
                <button class="btn btn--outline btn--full-width" onclick="closeModal()">Close</button>
            </div>
        </div>

        <!-- Verify Work Modal -->
        <div class="modal hidden" id="verifyWorkModal">
            <div class="modal-header">
                <h3>Verify Completed Work</h3>
                <button class="modal-close" onclick="closeModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p>Has the issue been resolved to your satisfaction?</p>
                <div class="verify-options">
                    <button class="btn btn--primary btn--full-width" onclick="verifyWork(true)">
                        <i class="fas fa-check"></i> Yes, Issue Resolved
                    </button>
                    <button class="btn btn--outline btn--full-width" onclick="verifyWork(false)">
                        <i class="fas fa-times"></i> No, Still an Issue
                    </button>
                </div>
            </div>
        </div>

        <!-- Rate Service Modal -->
        <div class="modal hidden" id="rateServiceModal">
            <div class="modal-header">
                <h3>Rate Our Service</h3>
                <button class="modal-close" onclick="closeModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p>How would you rate the resolution of your issue?</p>
                <div class="rating-stars" id="ratingStars">
                    <i class="fas fa-star" data-rating="1"></i>
                    <i class="fas fa-star" data-rating="2"></i>
                    <i class="fas fa-star" data-rating="3"></i>
                    <i class="fas fa-star" data-rating="4"></i>
                    <i class="fas fa-star" data-rating="5"></i>
                </div>
                <div class="form-group">
                    <label class="form-label">Additional Comments (Optional)</label>
                    <textarea class="form-control" id="ratingComments" placeholder="Share your experience..." rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn--primary btn--full-width" onclick="submitRating()">
                    Submit Rating
                </button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>